{"version":3,"sources":["../../../../src/actions/dragDrop/beginDrag.ts"],"sourcesContent":["import { invariant } from '@react-dnd/invariant'\nimport type {\n\tAction,\n\tDragDropManager,\n\tXYCoord,\n\tBeginDragPayload,\n\tBeginDragOptions,\n\tDragDropMonitor,\n\tHandlerRegistry,\n\tIdentifier,\n} from '../../interfaces.js'\nimport { setClientOffset } from './local/setClientOffset.js'\nimport { isObject } from '../../utils/js_utils.js'\nimport { BEGIN_DRAG, INIT_COORDS } from './types.js'\n\nconst ResetCoordinatesAction = {\n\ttype: INIT_COORDS,\n\tpayload: {\n\t\tclientOffset: null,\n\t\tsourceClientOffset: null,\n\t},\n}\n\nexport function createBeginDrag(manager: DragDropManager) {\n\treturn function beginDrag(\n\t\tsourceIds: Identifier[] = [],\n\t\toptions: BeginDragOptions = {\n\t\t\tpublishSource: true,\n\t\t},\n\t): Action<BeginDragPayload> | undefined {\n\t\tconst {\n\t\t\tpublishSource = true,\n\t\t\tclientOffset,\n\t\t\tgetSourceClientOffset,\n\t\t}: BeginDragOptions = options\n\t\tconst monitor = manager.getMonitor()\n\t\tconst registry = manager.getRegistry()\n\n\t\t// Initialize the coordinates using the client offset\n\t\tmanager.dispatch(setClientOffset(clientOffset))\n\n\t\tverifyInvariants(sourceIds, monitor, registry)\n\n\t\t// Get the draggable source\n\t\tconst sourceId = getDraggableSource(sourceIds, monitor)\n\t\tif (sourceId == null) {\n\t\t\tmanager.dispatch(ResetCoordinatesAction)\n\t\t\treturn\n\t\t}\n\n\t\t// Get the source client offset\n\t\tlet sourceClientOffset: XYCoord | null = null\n\t\tif (clientOffset) {\n\t\t\tif (!getSourceClientOffset) {\n\t\t\t\tthrow new Error('getSourceClientOffset must be defined')\n\t\t\t}\n\t\t\tverifyGetSourceClientOffsetIsFunction(getSourceClientOffset)\n\t\t\tsourceClientOffset = getSourceClientOffset(sourceId)\n\t\t}\n\n\t\t// Initialize the full coordinates\n\t\tmanager.dispatch(setClientOffset(clientOffset, sourceClientOffset))\n\n\t\tconst source = registry.getSource(sourceId)\n\t\tconst item = source.beginDrag(monitor, sourceId)\n\t\t// If source.beginDrag returns null, this is an indicator to cancel the drag\n\t\tif (item == null) {\n\t\t\treturn undefined\n\t\t}\n\t\tverifyItemIsObject(item)\n\t\tregistry.pinSource(sourceId)\n\n\t\tconst itemType = registry.getSourceType(sourceId)\n\t\treturn {\n\t\t\ttype: BEGIN_DRAG,\n\t\t\tpayload: {\n\t\t\t\titemType,\n\t\t\t\titem,\n\t\t\t\tsourceId,\n\t\t\t\tclientOffset: clientOffset || null,\n\t\t\t\tsourceClientOffset: sourceClientOffset || null,\n\t\t\t\tisSourcePublic: !!publishSource,\n\t\t\t},\n\t\t}\n\t}\n}\n\nfunction verifyInvariants(\n\tsourceIds: Identifier[],\n\tmonitor: DragDropMonitor,\n\tregistry: HandlerRegistry,\n) {\n\tinvariant(!monitor.isDragging(), 'Cannot call beginDrag while dragging.')\n\tsourceIds.forEach(function (sourceId) {\n\t\tinvariant(\n\t\t\tregistry.getSource(sourceId),\n\t\t\t'Expected sourceIds to be registered.',\n\t\t)\n\t})\n}\n\nfunction verifyGetSourceClientOffsetIsFunction(getSourceClientOffset: any) {\n\tinvariant(\n\t\ttypeof getSourceClientOffset === 'function',\n\t\t'When clientOffset is provided, getSourceClientOffset must be a function.',\n\t)\n}\n\nfunction verifyItemIsObject(item: any) {\n\tinvariant(isObject(item), 'Item must be an object.')\n}\n\nfunction getDraggableSource(sourceIds: Identifier[], monitor: DragDropMonitor) {\n\tlet sourceId = null\n\tfor (let i = sourceIds.length - 1; i >= 0; i--) {\n\t\tif (monitor.canDragSource(sourceIds[i])) {\n\t\t\tsourceId = sourceIds[i]\n\t\t\tbreak\n\t\t}\n\t}\n\treturn sourceId\n}\n"],"names":["createBeginDrag","ResetCoordinatesAction","type","INIT_COORDS","payload","clientOffset","sourceClientOffset","manager","beginDrag","sourceIds","options","publishSource","getSourceClientOffset","monitor","getMonitor","registry","getRegistry","dispatch","setClientOffset","verifyInvariants","sourceId","getDraggableSource","Error","verifyGetSourceClientOffsetIsFunction","source","getSource","item","undefined","verifyItemIsObject","pinSource","itemType","getSourceType","BEGIN_DRAG","isSourcePublic","invariant","isDragging","forEach","isObject","i","length","canDragSource"],"mappings":"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"}